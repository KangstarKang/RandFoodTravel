<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>디저트 맛집 추천</title>
    <style>
        #map {
            width: 100%;
            height: 400px;
            /* 지도의 높이 설정 */
        }

        #restaurants {
            margin-top: 20px;
        }

        .restaurant {
            margin-bottom: 20px;
        }

        .restaurant img {
            width: 100px;
            height: 100px;
            margin-right: 10px;
            vertical-align: middle;
        }
    </style>
</head>

<body>
    <h1>디저트 맛집 추천</h1>
    <div id="map"></div>

    <div id="restaurants">
        <h2>주변 맛집</h2>
        <div id="restaurantList"></div>
    </div>

    <script type="text/javascript"
        src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=6xu9y2eg88"></script>
    <script>
        // 사용자 위치를 받아오고 주변 음식점 검색을 시작하는 함수
        function getUserLocationAndSearchRestaurants() {
            if (navigator.geolocation) {
                // 사용자에게 위치 정보 제공 요청
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;
                        sendUserLocation(latitude, longitude);
                        searchRestaurants(latitude, longitude);
                    },
                    function (error) {
                        // 위치 정보를 받아오는 데 실패한 경우에 대한 처리
                        alert('사용자의 위치를 찾을 수 없습니다. 위치 정보를 허용해주세요.');
                    }
                );
            } else {
                // 브라우저가 위치 서비스를 지원하지 않는 경우에 대한 처리
                alert('브라우저가 위치 서비스를 지원하지 않습니다.');
            }
        }

        // 사용자 위치를 받아와서 지도에 표시하는 함수
        function sendUserLocation(latitude, longitude) {
            const mapOptions = {
                center: new naver.maps.LatLng(latitude, longitude), // 사용자 위치를 중심으로 지도 표시
                zoom: 15, // 초기 확대 수준 설정
                scaleControl: true // 지도 축척 컨트롤 표시
            };
            const map = new naver.maps.Map('map', mapOptions);

            // 사용자 위치에 마커 표시
            const marker = new naver.maps.Marker({
                position: new naver.maps.LatLng(latitude, longitude),
                map: map
            });

            // 서버로 사용자 위치 정보를 POST 요청으로 전송
            fetch('/userLocation', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ latitude, longitude }) // JSON 형태로 데이터 전송
            })
                .then(response => {
                    if (response.ok) {
                        console.log('User location sent successfully.');
                    } else {
                        console.error('Failed to send user location.');
                    }
                })
                .catch(error => {
                    console.error('Error sending user location:', error);
                });
        }

        // 페이지 로드 시 사용자 위치를 받아오고 주변 음식점 검색 시작
        getUserLocationAndSearchRestaurants();

        // 서버로부터 받아온 음식점 정보를 페이지에 표시하는 함수
        function displayRestaurants(restaurants) {
            const restaurantList = document.getElementById('restaurantList');

            restaurants.forEach(restaurant => {
                const li = document.createElement('li');
                li.textContent = restaurant.title; // 음식점 이름만을 표시
                console.log(restaurant.title);
                restaurantList.appendChild(li);
            });
        }
        // 주변 음식점을 검색하여 화면에 표시하는 함수
        function searchRestaurants(latitude, longitude) {
            // 음식점 검색 API 호출
            fetch('/searchRestaurants', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ latitude, longitude, foodPreference: '중식' })
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data); // 받은 데이터를 콘솔에 출력
                    if (data && data.length > 0) {
                        displayRestaurants(data); // 받은 데이터를 화면에 표시
                    } else {
                        console.error('Error: No restaurants found');
                    }
                })
                .catch(error => {
                    console.error('Error fetching restaurants:', error);
                });
        }


    </script>
</body>

</html>